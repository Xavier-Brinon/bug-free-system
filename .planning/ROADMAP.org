#+title: Roadmap: BookTab
#+author: BookTab
#+date: [2026-02-25 Tue]
#+startup: indent
#+options: toc:2 num:t ^:{}

- *Project* :: BookTab — Firefox New Tab Book Tracker
- *Core Value* :: Every new tab is a reminder of what you're reading and
  what's next — keeping your reading life visible without leaving the browser.
- *Created* :: [2026-02-25 Tue]
- *Revised* :: [2026-02-26 Thu] -- Phase 1 gains 3 ADR tasks (React, TanStack
  Query, Storybook); ADR numbering revised; ADR rule: write before each
  decision, supersede on change, never rewrite history
- *Depth* :: Comprehensive
- *Coverage* :: 25/25 v1 requirements mapped ✓

* Phases

- [ ] *Phase 1: Tooling & Practice Foundation* -- ADR infrastructure, Vitest
  + TDD methodology locked in, React/TanStack/Storybook decisions recorded
  before any feature code
- [ ] *Phase 2: Extension Scaffold* -- Working Firefox extension shell with
  versioned data schema, XState + React wiring, Storybook setup, Playwright
  smoke test infrastructure, and all critical pitfalls pre-empted
- [ ] *Phase 3: Library CRUD* -- User can add, edit, delete, and change the
  status of books; the core data loop works end-to-end
- [ ] *Phase 4: New Tab Display* -- Current book is shown prominently on every
  new tab; empty and populated states both handled
- [ ] *Phase 5: Queue* -- Want-to-read list is visible and annotatable with
  intention notes
- [ ] *Phase 6: Data Safety* -- User can export and safely import their
  library; no data can be destroyed without a backup

#+begin_src mermaid :file ./images/roadmap-phase-deps.svg :theme neutral
graph LR
    P1["Phase 1\nTooling &\nPractice"]
    P2["Phase 2\nExtension\nScaffold"]
    P3["Phase 3\nLibrary\nCRUD"]
    P4["Phase 4\nNew Tab\nDisplay"]
    P5["Phase 5\nQueue"]
    P6["Phase 6\nData Safety"]

    P1 --> P2
    P2 --> P3
    P3 --> P4
    P3 --> P5
    P4 --> P6
    P5 --> P6
#+end_src
#+RESULTS:
[[file:./images/roadmap-phase-deps.svg]]

* Phase Details

** Phase 1: Tooling & Practice Foundation
:PROPERTIES:
:CUSTOM_ID: phase-1
:END:

*** Goal

All developer tooling, testing infrastructure, and documented practices are
in place before a single feature is written -- so every subsequent phase
builds on a known-good foundation. ADRs for the decisions made so far
(Vitest, TDD, React 19, TanStack Query, Storybook) are written here.
Remaining ADRs (XState, storage, Playwright, Open Library, JSON schema)
are written at the start of the phase where each decision is first
implemented.

*** Dependencies

Nothing (first phase).

*** Requirements

ADR-01, ADR-02, ADR-03, DEV-01, DEV-02, DEV-03, DEV-04, DEV-05, DEV-06

*** Success criteria

1. =docs/decisions/= directory exists with MADR 4.0 template (org-mode) and
   five ADRs covering decisions made before Phase 2: Vitest, TDD methodology,
   React 19, TanStack Query, Storybook
2. =vitest.config.ts= is present with jsdom environment and ~npm run test~
   executes successfully, returning no failures on an empty test suite
3. A contributor can read =docs/decisions/= and understand the rationale for
   every architectural choice made so far -- no undocumented decisions exist
4. The red-green-refactor workflow is documented in an ADR and practice rules
   (no bulk tests, public-interface-only, mandatory tidy-up) are captured in
   =CONTRIBUTING.org= or equivalent
5. Every subsequent phase plan is constrained to follow the documented
   practices -- the guardrails are on paper before any code is written

*** Plans

5 plans across 2 waves.

Plans:
- [ ] 01-01-PLAN.md — ADR infrastructure (docs/decisions/ + MADR template) + CONTRIBUTING.org
- [ ] 01-02-PLAN.md — Vitest + React + TanStack configuration (package.json + vitest.config.ts + tsconfig.json)
- [ ] 01-03-PLAN.md — ADR-0001 (Vitest) + ADR-0002 (TDD) + ADR-0003 (React) + ADR-0004 (TanStack Query) + ADR-0005 (Storybook)

** Phase 2: Extension Scaffold
:PROPERTIES:
:CUSTOM_ID: phase-2
:END:

*** Goal

A working Firefox extension that loads as the new tab page, reads and writes
data to ~browser.storage.local~ with a versioned schema, manages all state
via XState v5 actors wired into React components via ~@xstate/react~, has
Storybook configured for component isolation, and pre-empts every critical
pitfall identified in research. Playwright / Chromium E2E smoke test
infrastructure is introduced here alongside the first Vite production build.

*** Dependencies

Phase 1.

*** Requirements

CORE-01, CORE-02, CORE-03, CORE-04

*** Success criteria

1. Installing the extension in Firefox and opening a new tab loads the
   extension's page (not Firefox's default) -- confirmed via =about:debugging=
2. No inline JavaScript and no CDN-hosted scripts exist anywhere in the
   codebase -- ~web-ext lint~ passes with zero CSP warnings
3. Opening a new tab, writing a book record, and refreshing shows the same
   data -- no async race condition can corrupt state
4. The data stored in ~browser.storage.local~ contains a =schemaVersion= field
   inspectable via the browser console; the schema matches the locked definition
5. All stateful logic is wired through XState v5 machine/actor(s) -- no
   ad-hoc flags manage async transitions
6. Storybook runs (~npm run storybook~) and displays at least one component
   story without error
7. Playwright smoke test suite runs against the Chromium build and passes

*** Plans

TBD -- includes:
- ADR-0006 (Playwright / Chromium E2E strategy) -- written before E2E scaffold
- ADR-0007 (XState v5 state management) -- written before machine code
- ADR-0008 (browser.storage.local only) -- written before storage layer
- Storybook setup + first story
- Playwright smoke test scaffold

** Phase 3: Library CRUD
:PROPERTIES:
:CUSTOM_ID: phase-3
:END:

*** Goal

Users can build their book library: adding books manually, updating details,
changing reading status, and deleting books they no longer want tracked.

*** Dependencies

Phase 2.

*** Requirements

LIB-01, LIB-02, LIB-03, LIB-04

*** Success criteria

1. User can open a form, enter a book title and author (cover URL optional),
   submit, and see the book appear in their library without a page reload
2. User can change any book's status between Want to Read, Reading, and Read
   -- the change persists across tab closes and browser restarts
3. User can open an existing book's details and edit its title, author, or
   cover URL -- the update is reflected immediately
4. User can delete a book from the library -- it is gone after refresh
5. All four CRUD operations are covered by tests that exercise the public
   interface (no internal mocks) and were written red-first before the
   implementation

*** Plans

TBD

** Phase 4: New Tab Display
:PROPERTIES:
:CUSTOM_ID: phase-4
:END:

*** Goal

Every new tab surfaces the user's current book prominently, with a clear
empty state when no book is being read and a visible to-read count to
motivate queue management.

*** Dependencies

Phase 3.

*** Requirements

DISP-01, DISP-02, DISP-03

*** Success criteria

1. When a book is set to Reading, opening a new tab shows that book's title
   and author in the hero area -- visually dominant, not buried in a list
2. When no book has Reading status, the new tab shows an empty state with a
   prompt (not a blank page, not an error)
3. A count of Want to Read books is visible on the new tab page at all times
   -- user does not need to navigate anywhere to see how many are queued
4. Switching a book to Reading after close/reopen updates the hero display
   correctly -- no stale state shown

*** Plans

TBD

** Phase 5: Queue
:PROPERTIES:
:CUSTOM_ID: phase-5
:END:

*** Goal

Users can see all their queued books in one place and annotate each with a
note capturing why they want to read it -- so the queue is not just a list
but a record of intention.

*** Dependencies

Phase 3.

*** Requirements

QUEUE-01, QUEUE-02

*** Success criteria

1. User can navigate to a queue view that lists all books with Want to Read
   status -- the list is not mixed with books in other states
2. User can open any queued book and add or edit a free-form text note
   explaining why they want to read it -- the note persists across sessions
3. A queued book's intention note is visible when viewing that book's details
   -- no navigation required to find it

*** Plans

TBD

** Phase 6: Data Safety
:PROPERTIES:
:CUSTOM_ID: phase-6
:END:

*** Goal

Users own their data. They can download a complete JSON snapshot at any
time, and import a snapshot to restore or migrate their library -- with no
risk of silent data loss during import.

*** Dependencies

Phase 5.

*** Requirements

DATA-01, DATA-02, DATA-03

*** Success criteria

1. User can click an Export action and receive a =.json= file download
   containing their complete library -- all books, statuses, notes, and the
   schema version field
2. User can import a previously exported =.json= file -- the library is
   restored with all books, statuses, and notes intact; no data is silently
   dropped
3. Before any import completes, a backup =.json= file is automatically
   created -- if something goes wrong, the user has a recovery point without
   any manual action
4. Importing a file that fails schema validation is rejected with an
   informative error -- the existing library is never touched on a failed
   import
5. The exported JSON is human-readable and re-importable: a user can open it
   in a text editor, understand its structure, and re-import it without
   modification

*** Plans

TBD

* Progress

#+CAPTION: Phase progress tracker
#+NAME: tab:progress
| Phase | Name                        | Plans Complete | Status      | Completed |
|-------+-----------------------------+----------------+-------------+-----------|
|     1 | Tooling & Practice          | 0/3            | Not started | --        |
|     2 | Extension Scaffold          | 0/?            | Not started | --        |
|     3 | Library CRUD                | 0/?            | Not started | --        |
|     4 | New Tab Display             | 0/?            | Not started | --        |
|     5 | Queue                       | 0/?            | Not started | --        |
|     6 | Data Safety                 | 0/?            | Not started | --        |

* Coverage Map

#+CAPTION: Requirements coverage by phase
#+NAME: tab:coverage
| Requirement | Phase | Description                                              |
|-------------+-------+----------------------------------------------------------|
| ADR-01      |     1 | =docs/decisions/= initialized with MADR 4.0 template    |
| ADR-02      |     1 | ADR written before every architecturally significant decision |
| ADR-03      |     1 | Each phase plan includes at least one ADR task           |
| DEV-01      |     1 | Vitest configured as the test framework                  |
| DEV-02      |     1 | Red-green-refactor vertical slicing for all features     |
| DEV-03      |     1 | No tests written in bulk after implementation            |
| DEV-04      |     1 | Tests exercise public interfaces only                    |
| DEV-05      |     1 | Each phase begins with mandatory tidy-up                 |
| DEV-06      |     1 | ADRs written for test framework and TDD choices          |
| CORE-01     |     2 | Extension replaces new tab via =chrome_url_overrides.newtab= |
| CORE-02     |     2 | All scripts are CSP-safe                                 |
| CORE-03     |     2 | Data schema includes =schemaVersion= from day one        |
| CORE-04     |     2 | All app state managed via XState v5 machines/actors      |
| LIB-01      |     3 | User can add a book manually                             |
| LIB-02      |     3 | User can set a book's status                             |
| LIB-03      |     3 | User can edit a book's details                           |
| LIB-04      |     3 | User can delete a book                                   |
| DISP-01     |     4 | Current book shown prominently on new tab                |
| DISP-02     |     4 | Empty state shown when no book is Reading                |
| DISP-03     |     4 | To-read count visible on new tab                         |
| QUEUE-01    |     5 | User can view all Want to Read books                     |
| QUEUE-02    |     5 | User can add an intention note to a queued book          |
| DATA-01     |     6 | User can export all library data as JSON                 |
| DATA-02     |     6 | User can import library data from JSON                   |
| DATA-03     |     6 | Auto-backup created before any import                    |

Total v1 mapped: 25/25 ✓

* Key Decisions

#+CAPTION: ADR log -- written before each decision is implemented; superseded if revised
| Decision                                    | ADR file                  | Phase written |
|---------------------------------------------+---------------------------+---------------|
| Test framework: Vitest                      | =0001-vitest.org=         |             1 |
| TDD: red-green-refactor vertical slices     | =0002-tdd.org=            |             1 |
| UI layer: React 19                          | =0003-react.org=          |             1 |
| Async storage: TanStack Query               | =0004-tanstack-query.org= |             1 |
| Component isolation: Storybook              | =0005-storybook.org=      |             1 |
| E2E testing: Playwright / Chromium          | =0006-playwright.org=     |             2 |
| State management: XState v5                 | =0007-xstate.org=         |             2 |
| Storage: ~browser.storage.local~ only       | =0008-storage.org=        |             2 |
| Book metadata: Open Library (no API key)    | =0009-open-library.org=   |             3 |
| Data portability: versioned JSON export     | =0010-json-schema.org=    |             6 |

* Depth Calibration Note

Depth setting is *comprehensive* (target 8--12 phases). This project's 25 v1
requirements cluster into 6 natural delivery boundaries that each complete a
coherent, independently verifiable capability. Padding to 8+ phases would
require artificial splits (e.g., separating "add book" from "set status")
that would create partial, unverifiable states. 6 phases is the honest
comprehensive read for this scope.

---
/Roadmap created: [2026-02-25 Tue]/
/Revised: [2026-02-26 Thu] -- React/TanStack/Storybook stack confirmed; ADR rule: write before decision, supersede on change, never rewrite history/
/Requirements: 25 v1, 0 orphaned/
