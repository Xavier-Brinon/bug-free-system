---
phase: 03-library-crud
plan: "03"
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/BookCard.tsx
  - src/components/BookList.tsx
  - tests/browser/BookCard.test.tsx
  - tests/browser/BookList.test.tsx
autonomous: true
requirements:
  - LIB-02
  - LIB-04

must_haves:
  truths:
    - "BookCard displays a single book's title, author(s), status badge, and optional cover"
    - "BookCard has an Edit button that calls onEdit callback"
    - "BookCard has a Delete button that calls onDelete callback"
    - "BookCard has a status selector (dropdown or button group) for changing status"
    - "Status change calls onStatusChange callback with the new status"
    - "BookList renders a list of BookCard components from a books record"
    - "BookList shows an empty state message when no books exist"
    - "All code written via TDD: tests first, implementation second"
    - "Tests use Vitest browser mode (vitest-browser-react) — real DOM rendering"
  artifacts:
    - path: "src/components/BookCard.tsx"
      provides: "Single book display with status badge, edit/delete actions, status change"
    - path: "src/components/BookList.tsx"
      provides: "List of BookCard components with empty state"
    - path: "tests/browser/BookCard.test.tsx"
      provides: "Browser-mode component tests for BookCard"
    - path: "tests/browser/BookList.test.tsx"
      provides: "Browser-mode component tests for BookList"
  key_links:
    - from: "src/components/BookCard.tsx"
      to: "src/schema.ts"
      via: "Renders BookRecord data"
    - from: "src/components/BookList.tsx"
      to: "src/components/BookCard.tsx"
      via: "Renders one BookCard per book"
    - from: "src/components/BookList.tsx"
      to: "src/newtab/App.tsx (Plan 03-04)"
      via: "App renders BookList and connects callbacks to library machine"
---

<objective>
Create BookCard and BookList components for displaying books, changing status,
and triggering edit/delete actions.

Purpose: LIB-02 requires status changes between Want to Read / Reading / Read.
LIB-04 requires deleting books. These components provide the UI for both. BookCard
is the single-book display unit; BookList renders the collection with an empty
state fallback. Both are tested in browser mode with real DOM interactions.

Output:
- src/components/BookCard.tsx (single book display with actions)
- src/components/BookList.tsx (list of BookCard components)
- Browser-mode tests for both components
</objective>

<execution_context>
@/Users/xavierbrinon/.config/Claude/get-shit-done/workflows/execute-plan.md
@/Users/xavierbrinon/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.org
@.planning/STATE.org
@src/schema.ts
@src/newtab/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BookCard component with TDD (browser tests)</name>
  <files>src/components/BookCard.tsx
tests/browser/BookCard.test.tsx</files>
  <action>
Write tests first, then implementation. Follow TDD red-green-refactor.
Tests run in Vitest browser mode using vitest-browser-react's render().

BookCard props:
  { book: BookRecord; onEdit: (id: string) => void;
    onDelete: (id: string) => void;
    onStatusChange: (id: string, status: BookStatus) => void }

Test 1 (RED): BookCard renders the book title
  → Create component that displays book.title (GREEN)

Test 2 (RED): BookCard renders the author(s) joined by comma
  → Display book.authors.join(", ") (GREEN)

Test 3 (RED): BookCard renders a status badge showing the current status
  → Display formatted status text (GREEN)

Test 4 (RED): BookCard renders cover image when coverUrl is provided
  → Conditionally render img with book.coverUrl (GREEN)

Test 5 (RED): BookCard does not render cover image when coverUrl is absent
  → Verify no img element when coverUrl is undefined (GREEN)

Test 6 (RED): Clicking Edit button calls onEdit with the book's id
  → Wire edit button to onEdit callback (GREEN)

Test 7 (RED): Clicking Delete button calls onDelete with the book's id
  → Wire delete button to onDelete callback (GREEN)

Test 8 (RED): Changing status via select/buttons calls onStatusChange
  → Wire status selector to onStatusChange callback (GREEN)

Use a <select> element for status changes (accessible, simple). Display status
labels: "Want to Read", "Reading", "Read" (human-readable, not raw enum values).
  </action>
  <verify>
    <automated>npm run test -- --project browser</automated>
  </verify>
  <done>BookCard renders book info; edit/delete buttons work; status change works; cover image conditional; all browser tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Create BookList component with TDD (browser tests)</name>
  <files>src/components/BookList.tsx
tests/browser/BookList.test.tsx</files>
  <action>
Write tests first, then implementation. Follow TDD red-green-refactor.
Tests run in Vitest browser mode using vitest-browser-react's render().

BookList props:
  { books: Record<string, BookRecord>;
    onEdit: (id: string) => void;
    onDelete: (id: string) => void;
    onStatusChange: (id: string, status: BookStatus) => void }

Test 1 (RED): BookList renders empty state message when books is empty
  → Display "No books yet" or similar message (GREEN)

Test 2 (RED): BookList renders one BookCard per book in the record
  → Map over Object.values(books) and render BookCard for each (GREEN)

Test 3 (RED): BookList passes onEdit callback through to BookCard
  → Verify clicking edit on a card calls onEdit with correct id (GREEN)

Test 4 (RED): BookList passes onDelete callback through to BookCard
  → Verify clicking delete on a card calls onDelete with correct id (GREEN)

BookList is a thin wrapper — it maps books to BookCards and handles empty state.
No filtering or sorting in this plan (that comes in later phases if needed).
  </action>
  <verify>
    <automated>npm run test -- --project browser</automated>
  </verify>
  <done>BookList renders empty state or list of BookCards; callbacks pass through correctly; all browser tests pass</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run test -- --project browser` passes all BookCard and BookList tests
2. `npm run test` passes all tests (unit + browser + storybook)
3. `npm run build` succeeds
4. BookCard displays book info with edit/delete/status-change actions
5. BookList renders empty state or list of BookCards
</verification>

<success_criteria>
- BookCard enables status changes between all three states (LIB-02 ✓)
- BookCard provides delete action (LIB-04 ✓)
- BookList handles empty and populated states
- All components are isolated — no global state, no machine dependency
- All code written via TDD with browser-mode tests
</success_criteria>

<output>
After completion, create `.planning/phases/03-library-crud/03-03-SUMMARY.md` using the summary template.
</output>
