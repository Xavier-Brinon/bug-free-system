---
phase: 01-tooling-practice
plan: "03"
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - docs/decisions/0001-vitest.org
  - docs/decisions/0002-tdd.org
autonomous: true
requirements:
  - DEV-02
  - DEV-03
  - DEV-04
  - DEV-06

must_haves:
  truths:
    - "An ADR exists documenting why Vitest was chosen over alternatives (Jest, Mocha, etc.)"
    - "An ADR exists documenting the TDD red-green-refactor methodology and its constraints (no bulk tests, public interface only)"
    - "Both ADRs follow MADR 4.0 org-mode format and have status: Accepted"
    - "A contributor reading docs/decisions/ can understand every architectural choice made so far"
  artifacts:
    - path: "docs/decisions/0001-vitest.org"
      provides: "ADR for test framework selection: Vitest chosen, Jest/Mocha considered and rejected"
      contains: "Status: Accepted"
    - path: "docs/decisions/0002-tdd.org"
      provides: "ADR for TDD methodology: red-green-refactor vertical slicing, public interfaces only, no bulk tests"
      contains: "Status: Accepted"
  key_links:
    - from: "docs/decisions/0001-vitest.org"
      to: "vitest.config.ts (Plan 02)"
      via: "ADR documents the decision already implemented in Plan 02"
      pattern: "Decision Outcome.*Vitest"
    - from: "docs/decisions/0002-tdd.org"
      to: "CONTRIBUTING.org (Plan 01)"
      via: "ADR provides architectural rationale for rules captured in CONTRIBUTING.org"
      pattern: "red-green-refactor"
---

<objective>
Write the two foundational ADRs that document the test framework and TDD methodology choices before any feature code is written.

Purpose: ADR-06 requires these ADRs to exist before Phase 1 execution. They provide the "why" behind the tooling decisions so that future contributors (and future phases) understand the constraints are intentional — not arbitrary.

Output:
- docs/decisions/0001-vitest.org — ADR for Vitest as test framework (status: Accepted)
- docs/decisions/0002-tdd.org — ADR for TDD red-green-refactor methodology (status: Accepted)

Prerequisites: docs/decisions/ must exist (created in Plan 01).
</objective>

<execution_context>
@/Users/xavierbrinon/.config/Claude/get-shit-done/workflows/execute-plan.md
@/Users/xavierbrinon/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.org
@.planning/STATE.org
@.planning/research/STACK.org
@.planning/phases/01-tooling-practice/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write ADR-0001 — Vitest as test framework</name>
  <files>docs/decisions/0001-vitest.org</files>
  <action>
Copy the structure from docs/decisions/0000-template.org and create docs/decisions/0001-vitest.org.

This ADR documents the choice of Vitest as the test framework for BookTab. Use the exact MADR 4.0 org-mode structure from the template. All content must be accurate based on the project's actual constraints.

Required content:

- **Title**: Use Vitest as the test framework
- **Status**: Accepted
- **Context and Problem Statement**: BookTab is a TypeScript project built with Vite 7. We need a test framework for TDD red-green-refactor. The framework must support native ESM (no CommonJS transform required), TypeScript without additional configuration, and fast execution for a tight red-green loop.
- **Decision Drivers**:
  - Native ESM support (no jest.config transform setup)
  - Same configuration as Vite (no parallel config maintenance)
  - Fast execution for tight TDD feedback loop
  - TypeScript support without Babel/ts-jest
  - Actively maintained (2025/2026)
- **Considered Options**:
  - Vitest
  - Jest (with ts-jest or Babel transform)
  - Mocha + Chai
- **Decision Outcome**: Chosen: Vitest. Because it shares Vite's configuration, supports native ESM and TypeScript without extra transforms, and has a compatible API surface with Jest (easy for contributors familiar with Jest).
- **Positive Consequences**: No transform setup; same vitest.config.ts as vite.config.ts pattern; fast (~100ms startup); stable API.
- **Negative Consequences**: Vitest requires Vite in the toolchain (already a dependency for this project — not a new constraint).
- **Pros and Cons sections**: Fill in for all three options with honest trade-offs.

The ADR must be factually accurate and represent the real rationale captured in STACK.org research.
  </action>
  <verify>
    <automated>ls docs/decisions/0001-vitest.org && grep "Status" docs/decisions/0001-vitest.org | grep -i "accepted"</automated>
  </verify>
  <done>0001-vitest.org exists; Status is Accepted; contains Decision Outcome section naming Vitest; all MADR 4.0 sections present</done>
</task>

<task type="auto">
  <name>Task 2: Write ADR-0002 — TDD red-green-refactor methodology</name>
  <files>docs/decisions/0002-tdd.org</files>
  <action>
Copy the structure from docs/decisions/0000-template.org and create docs/decisions/0002-tdd.org.

This ADR documents the TDD red-green-refactor vertical slicing methodology adopted for BookTab. It must explain the specific constraints locked in STATE.org, not just generic TDD advocacy.

Required content:

- **Title**: Adopt TDD red-green-refactor vertical slicing for all features
- **Status**: Accepted
- **Context and Problem Statement**: BookTab needs a consistent testing approach. Without a documented methodology, tests tend to be written in bulk after implementation (reducing their value as design tools), or they test internal implementation details (making refactoring costly). We need a methodology that produces honest, maintainable tests.
- **Decision Drivers**:
  - Tests should drive design, not verify existing code
  - No tests written in bulk after implementation (DEV-03)
  - Tests must survive refactoring without rewrite (public interface only — DEV-04)
  - One cohesive behavior tested per cycle (vertical slice)
  - Each phase must begin with a cleanup pass (DEV-05)
- **Considered Options**:
  - Red-green-refactor vertical slicing (one test → one implementation → repeat)
  - Spec-first (write all tests, then all implementation)
  - Test-after (write implementation, then tests)
- **Decision Outcome**: Chosen: Red-green-refactor vertical slicing. Because it keeps test and implementation in sync, forces each test to be written when behavior is freshest in mind, and produces tests that are coupled to public behavior (not internal structure).
- **Specific constraints** (in the Positive Consequences or a sub-section):
  1. One test written → run (must fail, RED) → minimal implementation to pass (GREEN) → refactor if needed → repeat
  2. No writing multiple tests before any implementation
  3. Tests call only public exports — no importing private functions, no mocking internals
  4. Each phase begins with a tidy-up commit before any new feature work
- **Negative Consequences**: Slower initial velocity on simple features vs. write-all-tests-first. Accepted: design quality and refactor safety outweigh speed.

The ADR must be specific to BookTab's constraints, not a generic TDD explainer.
  </action>
  <verify>
    <automated>ls docs/decisions/0002-tdd.org && grep "Status" docs/decisions/0002-tdd.org | grep -i "accepted" && grep -i "red-green-refactor\|vertical" docs/decisions/0002-tdd.org</automated>
  </verify>
  <done>0002-tdd.org exists; Status is Accepted; contains specific constraints (public interface only, no bulk tests, tidy-up rule); all MADR 4.0 sections present</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `ls docs/decisions/` shows: README.org, 0000-template.org, 0001-vitest.org, 0002-tdd.org
2. Both ADRs have "Status" heading with "Accepted" value
3. `grep -n "Decision Outcome" docs/decisions/0001-vitest.org` — present
4. `grep -n "red-green-refactor\|vertical" docs/decisions/0002-tdd.org` — present
5. Both files are valid org-mode (no markdown syntax, #+title: header present)
</verification>

<success_criteria>
- ADR-0001 (Vitest) written and accepted — test framework choice documented (DEV-06 ✓)
- ADR-0002 (TDD) written and accepted — methodology and specific constraints documented (DEV-02, DEV-03, DEV-04, DEV-06 ✓)
- All ADRs follow MADR 4.0 org-mode format from the template
- A contributor reading docs/decisions/ understands the rationale for every architectural choice made so far (Phase 1 success criterion 3 ✓)
- Red-green-refactor workflow is documented with practice rules captured (Phase 1 success criterion 4 ✓)
</success_criteria>

<output>
After completion, create `.planning/phases/01-tooling-practice/01-03-SUMMARY.md` using the summary template.
</output>
