---
phase: 01-tooling-practice
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vitest.config.ts
  - tsconfig.json
autonomous: true
requirements:
  - DEV-01

must_haves:
  truths:
    - "npm run test executes successfully and returns no failures on an empty test suite"
    - "vitest.config.ts exists and configures Vitest correctly for the TypeScript project"
    - "TypeScript strict mode is enabled"
  artifacts:
    - path: "package.json"
      provides: "npm run test script wired to Vitest; all required devDependencies declared"
      contains: "\"test\": \"vitest\""
    - path: "vitest.config.ts"
      provides: "Vitest configuration: test file patterns, TypeScript support, no browser environment"
    - path: "tsconfig.json"
      provides: "TypeScript config with strict: true"
  key_links:
    - from: "vitest.config.ts"
      to: "tests/*.test.ts (future test files)"
      via: "include pattern matches tests/ directory"
      pattern: "include.*tests"
    - from: "package.json"
      to: "vitest"
      via: "npm run test"
      pattern: "\"test\": \"vitest\""
---

<objective>
Configure Vitest as the test framework so that `npm run test` works before any tests are written.

Purpose: The TDD workflow (red-green-refactor) requires a working test runner from the first commit. Every subsequent phase depends on `npm run test` being a reliable command. Set this up once, correctly, now.

Output:
- package.json with Vitest as devDependency and `npm run test` script
- vitest.config.ts with TypeScript-aware configuration
- tsconfig.json with strict mode enabled
- Empty tests/ directory (placeholder)
- `npm run test` executes and returns 0 failures on empty suite
</objective>

<execution_context>
@/Users/xavierbrinon/.config/Claude/get-shit-done/workflows/execute-plan.md
@/Users/xavierbrinon/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.org
@.planning/STATE.org
@.planning/research/STACK.org
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize npm project and install Vitest with TypeScript</name>
  <files>package.json</files>
  <action>
Check if package.json already exists in the project root. If it does not exist, initialize a new npm project:
  npm init -y

Then install the required devDependencies:
  npm install -D vitest typescript

Also install the webextension-polyfill types now (needed in Phase 2, add them as a devDependency to avoid reinstalling):
  npm install -D @types/webextension-polyfill

Update package.json to add the test script:
  "scripts": {
    "test": "vitest run",
    "test:watch": "vitest"
  }

The package name should be "booktab" and description "Firefox new tab book tracker".

NOTE: Do NOT install vite-plugin-web-extension, webextension-polyfill, xstate, or zod yet — those belong to Phase 2 when the extension is scaffolded. Only install what is needed for the Phase 1 testing foundation.
  </action>
  <verify>
    <automated>cat package.json | grep -E '"test":|vitest' && ls node_modules/.bin/vitest</automated>
  </verify>
  <done>package.json has "test": "vitest run" script; vitest is installed in devDependencies; node_modules/.bin/vitest exists</done>
</task>

<task type="auto">
  <name>Task 2: Configure Vitest and TypeScript for the project</name>
  <files>vitest.config.ts
tsconfig.json</files>
  <action>
Create vitest.config.ts in the project root:

```typescript
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    // Match test files in tests/ directory and any .test.ts files
    include: ['tests/**/*.test.ts', 'src/**/*.test.ts'],
    // No browser environment needed — tests run in Node/jsdom
    environment: 'node',
    // Clear mocks between tests
    clearMocks: true,
    // Type-check while testing (catches TypeScript errors in tests)
    typecheck: {
      enabled: false, // Enable per-test with vitest --typecheck if needed
    },
  },
});
```

Create tsconfig.json with strict mode:

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "strict": true,
    "noEmit": true,
    "skipLibCheck": true,
    "types": ["vitest/globals"]
  },
  "include": ["src/**/*.ts", "tests/**/*.ts"],
  "exclude": ["node_modules"]
}
```

Create an empty tests/ directory with a .gitkeep file so the directory is tracked in git:
  mkdir -p tests && touch tests/.gitkeep

Run the test suite to verify it passes on an empty suite:
  npm run test

The command must exit with code 0. An output like "No test files found, exiting with code 0" or "0 tests passed" is the expected result.
  </action>
  <verify>
    <automated>npm run test</automated>
  </verify>
  <done>vitest.config.ts exists; tsconfig.json exists with strict:true; `npm run test` exits 0 with no failures on empty suite; tests/ directory exists</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run test` exits with code 0
2. `cat vitest.config.ts` shows include patterns for tests/ and src/
3. `cat tsconfig.json` shows "strict": true
4. `ls tests/` shows the directory exists (with .gitkeep or empty)
5. `cat package.json | grep test` shows "vitest run" script
</verification>

<success_criteria>
- Vitest is installed and configured as the test framework (DEV-01 ✓)
- `npm run test` executes successfully with zero failures on empty suite (Phase 1 success criterion 2 ✓)
- TypeScript strict mode is on — no loose typing from day one
- No browser-dependent or CDN-loaded test infrastructure — everything local and bundled
</success_criteria>

<output>
After completion, create `.planning/phases/01-tooling-practice/01-02-SUMMARY.md` using the summary template.
</output>
