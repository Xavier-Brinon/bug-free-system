---
phase: 01-tooling-practice
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vitest.config.ts
  - tsconfig.json
autonomous: true
requirements:
  - DEV-01

must_haves:
  truths:
    - "npm run test executes successfully and returns no failures on an empty test suite"
    - "vitest.config.ts exists and configures Vitest with jsdom environment for React component tests"
    - "TypeScript strict mode is enabled with jsx: react-jsx"
    - "React 19, TanStack Query, @xstate/react, and @testing-library/react are installed"
  artifacts:
    - path: "package.json"
      provides: "npm run test script wired to Vitest; all required devDependencies and runtime dependencies declared"
      contains: "\"test\": \"vitest\""
    - path: "vitest.config.ts"
      provides: "Vitest configuration: jsdom environment, test file patterns, TypeScript support"
      contains: "environment: 'jsdom'"
    - path: "tsconfig.json"
      provides: "TypeScript config with strict: true and jsx: react-jsx"
      contains: "react-jsx"
  key_links:
    - from: "vitest.config.ts"
      to: "tests/*.test.ts and src/**/*.test.tsx (future test files)"
      via: "include pattern matches tests/ and src/ directories"
      pattern: "include.*tests"
    - from: "package.json"
      to: "vitest"
      via: "npm run test"
      pattern: "\"test\": \"vitest\""
---

<objective>
Configure Vitest (with jsdom), install React 19 + TanStack Query + @xstate/react +
@testing-library/react, and set up TypeScript so that `npm run test` works before
any tests are written.

Purpose: The TDD workflow (red-green-refactor) requires a working test runner from
the first commit. React component tests require jsdom (not Node). Every subsequent
phase depends on `npm run test` being a reliable command. Set this up once,
correctly, now.

Output:
- package.json with all runtime + devDependencies and `npm run test` script
- vitest.config.ts with jsdom environment and TypeScript-aware configuration
- tsconfig.json with strict mode + jsx: react-jsx
- Empty tests/ directory (placeholder)
- `npm run test` executes and returns 0 failures on empty suite
</objective>

<execution_context>
@/Users/xavierbrinon/.config/Claude/get-shit-done/workflows/execute-plan.md
@/Users/xavierbrinon/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.org
@.planning/STATE.org
@.planning/research/STACK.org
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize npm project and install all Phase 1 dependencies</name>
  <files>package.json</files>
  <action>
Check if package.json already exists in the project root. If it does not exist,
initialize a new npm project:
  npm init -y

Then install runtime dependencies:
  npm install react react-dom
  npm install xstate @xstate/react
  npm install @tanstack/react-query
  npm install webextension-polyfill
  npm install zod

Then install devDependencies:
  npm install -D vitest jsdom
  npm install -D @testing-library/react @testing-library/user-event @testing-library/jest-dom
  npm install -D @types/react @types/react-dom
  npm install -D @types/webextension-polyfill
  npm install -D typescript@^5.9.0
  npm install -D vite vite-plugin-web-extension
  npm install -D web-ext

Update package.json to add the test scripts:
  "scripts": {
    "test": "vitest run",
    "test:watch": "vitest"
  }

The package name should be "booktab" and description "Firefox new tab book tracker".

NOTE: Do NOT install Playwright or Storybook yet -- those belong to Phase 2
when the extension is scaffolded and the first component exists to render.
  </action>
  <verify>
    <automated>cat package.json | grep -E '"test":|"vitest"' && ls node_modules/.bin/vitest && ls node_modules/react && ls node_modules/@tanstack/react-query && ls node_modules/@testing-library/react</automated>
  </verify>
  <done>package.json has "test": "vitest run" script; vitest, react, @tanstack/react-query, and @testing-library/react are all installed; node_modules/.bin/vitest exists</done>
</task>

<task type="auto">
  <name>Task 2: Configure Vitest (jsdom) and TypeScript (react-jsx) for the project</name>
  <files>vitest.config.ts
tsconfig.json</files>
  <action>
Create vitest.config.ts in the project root:

```typescript
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    // Match test files in tests/ directory and any .test.ts/.test.tsx files
    include: ['tests/**/*.test.ts', 'tests/**/*.test.tsx', 'src/**/*.test.ts', 'src/**/*.test.tsx'],
    // jsdom environment required for React component tests (@testing-library/react)
    environment: 'jsdom',
    // Setup file to import @testing-library/jest-dom matchers globally
    setupFiles: ['./tests/setup.ts'],
    // Clear mocks between tests
    clearMocks: true,
  },
});
```

Create tests/setup.ts to import @testing-library/jest-dom matchers:

```typescript
import '@testing-library/jest-dom';
```

Create tsconfig.json with strict mode and React JSX transform:

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "strict": true,
    "noEmit": true,
    "skipLibCheck": true,
    "jsx": "react-jsx",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "types": ["vitest/globals"]
  },
  "include": ["src/**/*.ts", "src/**/*.tsx", "tests/**/*.ts", "tests/**/*.tsx"],
  "exclude": ["node_modules"]
}
```

Create an empty tests/ directory with a .gitkeep file so the directory is
tracked in git (setup.ts will already create the directory, so just add .gitkeep):
  touch tests/.gitkeep

Run the test suite to verify it passes on an empty suite:
  npm run test

The command must exit with code 0. An output like "No test files found,
exiting with code 0" or "0 tests passed" is the expected result.
  </action>
  <verify>
    <automated>npm run test</automated>
  </verify>
  <done>vitest.config.ts exists with environment: 'jsdom' and setupFiles; tsconfig.json exists with strict:true and jsx:react-jsx; tests/setup.ts imports @testing-library/jest-dom; `npm run test` exits 0 with no failures on empty suite</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run test` exits with code 0
2. `grep "jsdom" vitest.config.ts` returns a match
3. `grep "react-jsx" tsconfig.json` returns a match
4. `grep '"strict": true' tsconfig.json` returns a match
5. `ls tests/` shows setup.ts (and .gitkeep)
6. `cat package.json | grep test` shows "vitest run" script
7. `ls node_modules/react node_modules/@tanstack/react-query node_modules/@testing-library/react` all exist
</verification>

<success_criteria>
- Vitest is installed and configured with jsdom environment (DEV-01 âœ“)
- React 19, TanStack Query, @xstate/react, @testing-library/react installed
- `npm run test` executes successfully with zero failures on empty suite
- TypeScript strict mode is on with jsx: react-jsx -- React components will type-check
- No browser-dependent or CDN-loaded test infrastructure -- everything local and bundled
</success_criteria>

<output>
After completion, create `.planning/phases/01-tooling-practice/01-02-SUMMARY.md` using the summary template.
</output>
