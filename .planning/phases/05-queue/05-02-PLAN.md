---
phase: 05-queue
plan: "02"
type: execute
wave: 1
depends_on: ["05-01"]
files_modified:
  - src/components/QueueNoteEditor.tsx
  - tests/browser/QueueNoteEditor.test.tsx
  - src/components/BookCard.tsx
  - tests/browser/BookCard.test.tsx
autonomous: true
requirements:
  - QUEUE-02

must_haves:
  truths:
    - "QueueNoteEditor allows adding/editing a free-form text note for a queued book"
    - "QueueNoteEditor shows existing queueNote text when present"
    - "QueueNoteEditor provides Save and Cancel actions"
    - "BookCard displays queueNote text when present on a book"
    - "Note is visible in the book's details without additional navigation"
    - "All component logic written via TDD: browser tests first, implementation second"
    - "Tests exercise public interfaces only — no internal mocking"
  artifacts:
    - path: "src/components/QueueNoteEditor.tsx"
      provides: "Inline note editor component with textarea, save, and cancel"
    - path: "tests/browser/QueueNoteEditor.test.tsx"
      provides: "Browser tests for QueueNoteEditor rendering and interactions"
    - path: "src/components/BookCard.tsx"
      provides: "Updated to display queueNote when present"
    - path: "tests/browser/BookCard.test.tsx"
      provides: "Additional tests for queueNote display in BookCard"
  key_links:
    - from: "src/components/QueueNoteEditor.tsx"
      to: "src/schema.ts"
      via: "Imports BookRecord type for initial note value"
    - from: "src/components/QueueNoteEditor.tsx"
      to: "src/newtab/App.tsx (Plan 05-03)"
      via: "App renders QueueNoteEditor when editing a note in queue view"
    - from: "src/components/BookCard.tsx"
      to: "src/schema.ts"
      via: "Reads queueNote from BookRecord"
---

<objective>
Build the QueueNoteEditor component for adding/editing intention notes on
queued books, and update BookCard to display existing queue notes.

Purpose: QUEUE-02 requires users to add a note to a queued book explaining
why they want to read it. The note must persist and be visible when viewing
the book's details. QueueNoteEditor provides the editing UI (textarea with
save/cancel). BookCard is updated to show the note text when present.

Output:
- src/components/QueueNoteEditor.tsx — inline note editor
- Browser tests for QueueNoteEditor
- Updated src/components/BookCard.tsx — displays queueNote
- Additional BookCard browser tests for note display
</objective>

<execution_context>
@/Users/xavierbrinon/.config/Claude/get-shit-done/workflows/execute-plan.md
@/Users/xavierbrinon/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.org
@.planning/STATE.org
@src/schema.ts
@src/components/BookCard.tsx
@tests/browser/BookCard.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build QueueNoteEditor component with TDD (browser tests)</name>
  <files>src/components/QueueNoteEditor.tsx
tests/browser/QueueNoteEditor.test.tsx</files>
  <action>
Write browser tests first, then implementation. Follow TDD red-green-refactor.

The QueueNoteEditor is an inline editor for a book's queueNote.
Props:
  - bookId: string
  - initialNote: string (existing note or empty string)
  - onSave: (bookId: string, note: string) => void
  - onCancel: () => void

Test 1 (RED): Renders a textarea with the initial note text
  → Create component with textarea pre-filled with initialNote (GREEN)

Test 2 (RED): Renders an empty textarea when initialNote is empty
  → Handles empty string case (GREEN)

Test 3 (RED): Save button calls onSave with bookId and current textarea value
  → Wire save button to onSave callback (GREEN)

Test 4 (RED): Cancel button calls onCancel
  → Wire cancel button to onCancel callback (GREEN)

Test 5 (RED): User can type in the textarea to modify the note
  → Textarea is editable, state updates on change (GREEN)

Test 6 (RED): Textarea has appropriate label/placeholder for intention notes
  → Add "Why do you want to read this?" placeholder (GREEN)

Refactor pass: clean up prop types, ensure accessible labels.
  </action>
  <verify>
    <automated>npm run test -- --project browser</automated>
  </verify>
  <done>QueueNoteEditor renders textarea with save/cancel; all browser tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Update BookCard to display queueNote (TDD)</name>
  <files>src/components/BookCard.tsx
tests/browser/BookCard.test.tsx</files>
  <action>
Add queueNote display to the BookCard component.

Test 1 (RED): BookCard displays queueNote text when the book has a queueNote
  → Add a paragraph/section showing the note text (GREEN)

Test 2 (RED): BookCard does not render note section when queueNote is undefined
  → Conditional rendering — no empty note container (GREEN)

Refactor: ensure the note display is visually distinct (italic or different color)
and does not interfere with existing BookCard layout.
  </action>
  <verify>
    <automated>npm run test -- --project browser</automated>
  </verify>
  <done>BookCard displays queueNote when present; no extra markup when absent; all tests pass</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run lint && npm run fmt:check` pass
2. `npm run test` passes all tests (unit + browser + storybook)
3. `npm run build` succeeds
4. QueueNoteEditor allows editing free-form text notes
5. BookCard shows queueNote when present
6. All code written via TDD red-green-refactor
</verification>

<success_criteria>
- QueueNoteEditor provides full note editing UI (QUEUE-02 partial)
- BookCard shows intention note when viewing book details (success criterion #3)
- TDD red-green-refactor followed throughout
</success_criteria>

<output>
After completion, create `.planning/phases/05-queue/05-02-SUMMARY.md` using the summary template.
</output>
